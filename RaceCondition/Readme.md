# Exploitation Analysis of Bash Script Against Vulnerable Server

The exploitation by the Bash script leverages a race condition vulnerability in the server's handling of a global `money` variable, as observed in the `run_thread` function. This detailed analysis explains the exploitation process.

## Understanding the Vulnerability

- The `run_thread` function in the server code processes client commands without synchronization, directly affecting the global `money` variable. This function supports deposit (`money += 100`), withdraw (`money -= 100`), and purchase flag (`money -= 200` and sends flag content) operations, followed by a reset of `money` to `0`, which is a critical flaw.
- Due to the absence of synchronization, concurrent reads and writes to `money` by multiple threads can lead to unpredictable and inconsistent outcomes.

## Exploitation Strategy

1. **Concurrent Commands**: The exploit script sends concurrent `deposit` and `purchase flag` commands, aiming for simultaneous processing by the server's threads, exploiting the race condition.

2. **Rapid Deposit Commands**: The script rapidly sends two `deposit` commands, intending to increase `money` by `200` before any reset occurs. The `sleep 1` command ensures the server has time to process these commands.

3. **Timely Purchase Attempt**: Alongside the deposit commands, the script sends a `purchase flag` command, aiming for it to be processed while `money` is temporarily at `200` or more, before any thread resets it.

4. **Repetition for Increased Probability**: The script repeats this process `100` times to exploit the non-deterministic thread execution and timing, hoping for a moment when `money` is sufficiently high to allow the flag purchase.

5. **Flag Retrieval**: The script filters the server's responses with `grep '^pwn'`, capturing successful flag retrieval messages that start with 'pwn'.

## Why the Exploit Works

- **Exploiting Race Conditions**: The script successfully exploits the race condition due to unsynchronized access to `money`, creating a window where `money` is inaccurately high, allowing the purchase command to proceed erroneously.

- **Unpredictable Thread Scheduling**: The exploit relies on the inherent unpredictability of the operating system's thread scheduling, aiming for deposits to be processed just before the purchase, with resets happening afterwards.


