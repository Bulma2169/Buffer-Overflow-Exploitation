Exploitation Detail of Bash Script Against the Vulnerable Server
Given the run_thread function's implementation in the provided server code and the structure of the Bash exploit script, the exploitation fundamentally leverages the race condition vulnerability within the server's handling of the global money variable. Below is a detailed breakdown of the exploitation process:

Understanding the Vulnerability
The server's run_thread function processes client commands unsynchronized, directly manipulating the global money variable without any locking or synchronization mechanisms.
This function allows operations such as depositing (money += 100), withdrawing (money -= 100), and purchasing a flag (decreasing money by 200 if money >= 200 and then sending the flag content). After each operation, the money variable is reset to 0, which is a critical design flaw.
The absence of synchronization means simultaneous read and write operations on the money variable by multiple threads can lead to inconsistent and unpredictable outcomes.
Exploitation Strategy
Concurrent Commands: The script sends concurrent deposit and purchase flag commands. The goal is for these commands to be processed simultaneously by different server threads, exploiting the race condition.

Rapid Deposit Commands: The script rapidly sends two deposit commands aiming to increment the money variable by 200 before any reset. A brief pause (sleep 1) ensures the server processes these commands.

Timely Purchase Attempt: Almost in parallel with the deposit commands, the script sends a purchase flag command, intended to be processed when money is temporarily at 200 or more, before any resets.

Repetition for Increased Probability: The process is repeated 100 times to maximize the chances that, due to the non-deterministic nature of thread execution, the purchase flag command will be processed at a moment when money is sufficiently high, allowing the flag purchase.

Flag Retrieval: The script uses grep '^pwn' to filter output for successful flag retrieval messages, indicating that the flag or success message starts with 'pwn'.

Why the Exploit Works
Exploiting Race Conditions: The exploit is effective because the unsynchronized access to money creates a window where money reflects the deposit amounts but hasn't been reset. If the purchase flag command is processed within this window, the purchase is erroneously allowed.

Unpredictable Thread Scheduling: The exploit relies on the operating system's thread scheduling, which is inherently unpredictable, aiming for the deposits to be processed just before the purchase, with resets occurring afterwards.
