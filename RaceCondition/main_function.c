
undefined4 main(void)

{
  int iVar1;
  long in_FS_OFFSET;
  undefined4 local_48;
  int local_44;
  int local_40;
  uint local_3c;
  pthread_t local_38;
  int *local_30;
  sockaddr local_28;
  long local_10;
  
  local_10 = *(long *)(in_FS_OFFSET + 0x28);
  local_40 = 0;
  local_3c = 0x539;
  local_44 = 0;
  local_40 = socket(2,1,6);
  local_48 = 1;
  setsockopt(local_40,1,2,&local_48,4);
  local_28.sa_family = 2;
  local_28.sa_data[2] = '\0';
  local_28.sa_data[3] = '\0';
  local_28.sa_data[4] = '\0';
  local_28.sa_data[5] = '\0';
  local_28.sa_data._0_2_ = htons((uint16_t)local_3c);
  local_44 = bind(local_40,&local_28,0x10);
  if (local_44 < 0) {
    fprintf(stderr,"Cannot bind to port %d\n",(ulong)local_3c);
  }
  else {
    local_44 = listen(local_40,0x20);
    if (-1 < local_44) {
      printf("Listening for connections on port %d\n",(ulong)local_3c);
      puts("Commands:\n - \"deposit\"\n - \"withdraw\"\n - \"purchase flag\"");
      do {
        while( true ) {
          local_30 = (int *)malloc(0x18);
          iVar1 = accept(local_40,(sockaddr *)(local_30 + 1),(socklen_t *)(local_30 + 5));
          *local_30 = iVar1;
          if (0 < *local_30) break;
          free(local_30);
        }
        fwrite("Connection received! Creating a new handler thread...\n",1,0x36,stdout);
        pthread_create(&local_38,(pthread_attr_t *)0x0,run_thread,local_30);
        pthread_detach(local_38);
      } while( true );
    }
    fprintf(stderr,"Cannot listen on port %d\n",(ulong)local_3c);
  }
  local_44 = 1;
  if (local_10 != *(long *)(in_FS_OFFSET + 0x28)) {
                    /* WARNING: Subroutine does not return */
    __stack_chk_fail();
  }
  return 1;
}

